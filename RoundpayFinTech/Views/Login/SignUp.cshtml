@using Fintech.AppCode.Model
@model LoginPageModel
@{
    ViewData["Title"] = "Login";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
}
@if (Model.ThemeID != 4)
{
    <style>
        select.form-control:not([size]):not([multiple]) {
            height: calc(2.1rem + 2px );
        }
    </style>
    <div class="container">
        <div class="row">
            <input type="hidden" id="hdnReferralID" value="@Model.referralRoleMaster.ReferralID" />
            <div class="col-md-7 d-sm-none d-none d-md-block">
                <div class="d-flex justify-content-left m-3">
                    <img src="@ViewData["Host"]/Image/Website/@ViewData["WID"]/services.png" class="w-80" />
                </div>
            </div>
            <div class="col-md-5">
                <div class="" style="margin-top: 1em;">
                    <div class="d-flex flex-row-reverse h-100 ">
                        <div class="user_card">
                            <div class="d-flex justify-content-center">
                                <div class="logo d-flex justify-content-center">
                                    <img src="@ViewData["Host"]/Image/Website/@ViewData["WID"]/logo.png" style="height: 50px;" />
                                </div>
                            </div>
                            <div class="d-flex justify-content-center form_container">
                                <div class="w-100 row">

                                    <div class="input-group mb-2">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                                        </div>
                                        @Html.TextBox("txtName", null, new { @placeholder = ApplicationSetting.IsAPIExchange? "Properitor/Director" : "Name ", @class = "form-control input_user" })
                                    </div>

                                    <div class="input-group mb-2">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                                        </div>
                                        @Html.TextBox("txtOname", null, new { @placeholder = ApplicationSetting.IsAPIExchange? "Company/Firm Name":"Outlet Name", @class = "form-control" })
                                    </div>
                                    @if (!ApplicationSetting.IsAPIExchange)
                                    {
                                        <div class="input-group mb-2">
                                            <div class="input-group-append">
                                                <span class="input-group-text"><i class="fa fa-anchor"></i></span>
                                            </div>
                                            <select id="ddlRole" aria-describedby="roleHelp" tabindex="2" class="form-control">
                                                @if (Model.referralRoleMaster.Roles != null)
                                                {
                                                    if (Model.referralRoleMaster.Roles.Count() != 1)
                                                    {
                                                        <option selected value="0">:: Choose Role ::</option>
                                                        @foreach (var _roles in Model.referralRoleMaster.Roles)
                                                        {
                                                            <option value="@_roles.ID">@_roles.Role</option>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        @foreach (var _roles in Model.referralRoleMaster.Roles)
                                                        {
                                                            <option value="@_roles.ID">@_roles.Role</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>
                                    }
                                    <div class="input-group mb-2 ">
                                        <div class="input-group-append ">
                                            <span class="input-group-text"><i class="fa fa-phone"></i></span>
                                        </div>
                                        @Html.TextBox("txtMobileNo", null, new { @placeholder = "Mobile No", @class = "form-control" })
                                    </div>
                                    <div class="input-group mb-2">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="fa fa-envelope-open"></i></span>
                                        </div>
                                        @Html.TextBox("txtEmail", null, new { @placeholder = "Email", @class = "form-control" })
                                    </div>
                                    <div class="input-group mb-2">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                                        </div>
                                        @Html.TextBox("txtAddress", null, new { @placeholder = "Address", @class = "form-control" })
                                    </div>
                                    <div class="input-group mb-2">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="fa fa-globe"></i></span>
                                        </div>
                                        @Html.TextBox("txtPinCode", null, new { @placeholder = "Pin Code", @class = "form-control" })
                                    </div>
                                    @if (ApplicationSetting.IsAPIExchange)
                                    {
                                        <div class="col-md-6 pl-0">
                                            <div class="input-group mb-2">
                                                <div class="input-group-append">
                                                    <span class="input-group-text"><i class="fa fa-id-card"></i></span>
                                                </div>
                                                @Html.TextBox("txtGstno", null, new { @placeholder = "GST Number", @class = "form-control" })
                                            </div>

                                        </div>
                                        <div class="col-md-6 pl-0 pr-0">
                                            <div class="input-group mb-2">
                                                <div class="input-group-append">
                                                    <span class="input-group-text"><i class="fa fa-id-card-alt"></i></span>
                                                </div>
                                                @Html.TextBox("txtpannumber", null, new { @placeholder = "Pan Number", @class = "form-control" })
                                            </div>

                                        </div>
                                    }
                                    <div class="form-group">
                                        <small id="errorMsg" class="text-danger hide"></small>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center mt-2 login_container">
                                <button id="btnSignUp" type="button" value="LOGIN" class="btn login_btn">Sign Up</button>
                            </div>

                            <div class="d-flex justify-content-center form_container">

                                <div class="form-group">
                                    <span style="cursor:pointer" class="">
                                        Back To Login
                                        <a href="/Login" class=""><i class=""></i>Click Here</a>
                                    </span>
                                </div>
                                <div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <nav class="navbar navbar-expand-md secound-head top-nav">
        <div class="container">
            <div class="navbar-collapse" id="navbarSupportedContent">
                <a class="navbar-brand logo" href="#">
                    <img src="@(Model.Host)/Image/Website/@(Model.WID)/logo.png" />
                </a>
                <ul class="navbar-nav ml-auto  d-none d-sm-block">
                    <li class="nav-item ">
                        <div class="feature-box reverse-allres feature-box-style-2 align-items-center">
                            <div class="feature-box-icon">
                                <img src="@(Model.Host)/Image/Website/@(Model.WID)/@("t"+Model.ThemeID)/cc-info.png" style="width:67px;" />
                            </div>
                            <div class="feature-box-info">
                                <p class="pb-0 font-weight-semibold line-height-5 text-2 mt-4">
                                    @(Model.CustomerCareMobileNos)<br>
                                    @(Model.CustomerPhoneNos)
                                </p>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="login-page">
        <div class="container-fluid">
            <div class="row">
                <div class="col-xl-10 m-auto col-sm-12 col-12">
                    <div class="log-box">
                        <div class="row">
                            <div class="col-xl-7 col-sm-7 col-12 pad-right-0 d-none d-sm-block">
                                <div class="logo-back">
                                    <div class="slider rploginSlide">
                                        <div class="slide_viewer">
                                            <div class="slide_group">
                                                @{
                                                    if (Model.BGServiceImgURLs != null)
                                                    {
                                                        foreach (var item in Model.BGServiceImgURLs)
                                                        {
                                                            <div class="slide">
                                                                <img class="img-fluid" src="@(item.SiteResourceUrl)" />
                                                            </div>
                                                        }
                                                    }
                                                }
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slide_buttons"></div>
                                </div>
                            </div>
                            <div class="col-xl-5 col-sm-5 col-12 pad-left-0">
                                <div class="sign-content">
                                    <h3>Signup </h3>
                                    <div class="log-body">
                                        <div class="form-group myr-top">
                                            @Html.TextBox("txtName", null, new { @placeholder = "Name ", @class = "form-control input_user custom" })
                                        </div>

                                        <div class="form-group myr-top">
                                            @Html.TextBox("txtOname", null, new { @placeholder = "Outlet Name", @class = "form-control custom" })
                                        </div>
                                        @if (!ApplicationSetting.IsAPIExchange)
                                        {
                                            <div class="form-group myr-top">
                                                <select id="ddlRole" aria-describedby="roleHelp" tabindex="2" class="custom-select">
                                                    @if (Model.referralRoleMaster.Roles != null)
                                                    {
                                                        if (Model.referralRoleMaster.Roles.Count() != 1)
                                                        {
                                                            <option selected value="0">:: Choose Role ::</option>
                                                            @foreach (var _roles in Model.referralRoleMaster.Roles)
                                                            {
                                                                <option value="@_roles.ID">@_roles.Role</option>
                                                            }
                                                        }
                                                        else
                                                        {
                                                            @foreach (var _roles in Model.referralRoleMaster.Roles)
                                                            {
                                                                <option value="@_roles.ID">@_roles.Role</option>
                                                            }
                                                        }

                                                    }
                                                </select>
                                            </div>
                                        }
                                        <div class="form-group myr-top">
                                            @Html.TextBox("txtMobileNo", null, new { @placeholder = "Mobile No", @class = "form-control custom" })
                                        </div>
                                        <div class="form-group myr-top">
                                            @Html.TextBox("txtEmail", null, new { @placeholder = "Email", @class = "form-control custom" })
                                        </div>
                                        <div class="form-group myr-top">
                                            @Html.TextBox("txtAddress", null, new { @placeholder = "Address", @class = "form-control custom" })
                                        </div>
                                        <div class="form-group myr-top">
                                            @Html.TextBox("txtPinCode", null, new { @placeholder = "Pin Code", @class = "form-control custom" })
                                        </div>
                                        <div class="form-group myr-top">
                                            <small id="errorMsg" class="text-danger hide"></small>
                                        </div>
                                        <div class="sign-btn text-center">
                                            <button id="btnSignUp" type="button" value="LOGIN" class="btn btn-themeSign">Sign Up</button>
                                            <a href="/Login" class="btn btn-themeSign">Back to Login</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section scripts{
    @if (Model.ThemeID == 4)
    {
        <script type="text/javascript">
            $('.rploginSlide').each(function () {
                var $this = $(this);
                var $group = $this.find('.slide_group');
                var $slides = $this.find('.slide');
                var bulletArray = [];
                var currentIndex = 0;
                var timeout;

                function move(newIndex) {
                    var animateLeft, slideLeft;

                    advance();

                    if ($group.is(':animated') || currentIndex === newIndex) {
                        return;
                    }

                    bulletArray[currentIndex].removeClass('active');
                    bulletArray[newIndex].addClass('active');

                    if (newIndex > currentIndex) {
                        slideLeft = '100%';
                        animateLeft = '-100%';
                    } else {
                        slideLeft = '-100%';
                        animateLeft = '100%';
                    }

                    $slides.eq(newIndex).css({
                        display: 'block',
                        left: slideLeft
                    });
                    $group.animate({
                        left: animateLeft
                    }, function () {
                        $slides.eq(currentIndex).css({
                            display: 'none'
                        });
                        $slides.eq(newIndex).css({
                            left: 0
                        });
                        $group.css({
                            left: 0
                        });
                        currentIndex = newIndex;
                    });
                }

                function advance() {
                    clearTimeout(timeout);
                    timeout = setTimeout(function () {
                        if (currentIndex < ($slides.length - 1)) {
                            move(currentIndex + 1);
                        } else {
                            move(0);
                        }
                    }, 4000);
                }

                $('.next_btn').on('click', function () {
                    if (currentIndex < ($slides.length - 1)) {
                        move(currentIndex + 1);
                    } else {
                        move(0);
                    }
                });

                $('.previous_btn').on('click', function () {
                    if (currentIndex !== 0) {
                        move(currentIndex - 1);
                    } else {
                        move(3);
                    }
                });

                $.each($slides, function (index) {
                    var $button = $('<a class="slide_btn">•</a>');

                    if (index === currentIndex) {
                        $button.addClass('active');
                    }
                    $button.on('click', function () {
                        move(index);
                    }).appendTo('.slide_buttons');
                    bulletArray.push($button);
                });

                advance();
            });</script>
    }

    <script src="~/js/validator.js" asp-append-version="true"></script>
    <script src="~/js/login.js" asp-append-version="true"></script>

    <script>
        $(document).ready(function () {
            $('#btnSignUp').click(() => SignUp());
        });
        function SignUp() {
            var $v = $validator;
            errorMsg.removeClass('hide');
            let modal = {
                Name: $('#txtName'),
                OutletName: $('#txtOname'),
                DdlRole: $('#ddlRole'),
                MobileNo: $('#txtMobileNo'),
                Email: $('#txtEmail'),
                Address: $('#txtAddress'),
                PinCode: $('#txtPinCode'),
                ReferralID: $('#hdnReferralID'),
                GSTNo: $('#txtGstno'),
                PanNo: $('#txtpannumber'),
            };
            let obj = {
                Name: modal.Name.val(),
                OutletName: modal.OutletName.val(),
                RoleID: serverSetting.applicationSetting.IsAPIExchange ? 2 : modal.DdlRole.val(),
                MobileNo: modal.MobileNo.val(),
                EmailID: modal.Email.val(),
                Address: modal.Address.val(),
                Pincode: modal.PinCode.val(),
                ReferralID: modal.ReferralID.val(),
                GSTNo: modal.GSTNo.val(),
                PanNo: modal.PanNo.val(),
            };
            let IsE = {
                nam: ($v.$IsNum(obj.Name) || obj.Name.trim() == '' || obj.Name.length > 100),
                Onam: ($v.$IsNum(obj.OutletName) || obj.OutletName.trim() == '' || obj.OutletName.length > 100),
                rle: obj.RoleID === null || obj.RoleID == 0,
                mob: (obj.MobileNo.length !== 10 || !$v.$IsMob(obj.MobileNo)),
                eml: (!$v.$IsEmail(obj.EmailID) || obj.EmailID.length > 256),
                pnc: !$v.$IsPincode(obj.Pincode),
                gst: ((obj.GSTNo.trim() == '' && obj.PanNo.trim() == '') || (obj.GSTNo.trim() == 0 && obj.PanNo.trim() == 0))
            };

            $v.showErrorFor(modal.Name, 'Name is non-numeric mandatory field and length is not more than 100', IsE.nam);
            $v.showErrorFor(modal.OutletName, 'Name is non-numeric mandatory field and length is not more than 100', IsE.Onam);
            $v.showErrorFor(modal.DdlRole, 'Role is required, select role from list! (<i>In case of list is empty add role first</i>)', IsE.rle);
            $v.showErrorFor(modal.MobileNo, 'Mobile number is mandatory field and length should be 10', IsE.mob);
            $v.showErrorFor(modal.Email, 'Enter correct Email Id is mandatory field', IsE.eml);
            $v.showErrorFor(modal.PinCode, 'Enter correct PIN code is mandatory field', IsE.pnc);
            if (serverSetting.applicationSetting.IsAPIExchange) {
                $v.showErrorFor(modal.GSTNo, 'Enter correct GST No is mandatory field', IsE.gst);
            }
            IsE.err = (IsE.nam || IsE.Onam || IsE.rle || IsE.mob || IsE.eml || IsE.pnc || IsE.gst);
            if (IsE.err) {
                return false;
            }
            preloader.load();
            $.ajax({
                type: 'POST',
                url: '/Signup',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify(obj),
                success: function (result) {
                    an.title = result.statuscode == an.type.success ? "Well done" : "Oops";
                    an.content = result.msg;
                    an.alert(result.statuscode);
                    if (result.statuscode === 1)
                        $('input').val()
                }, statusCode: {
                    500: () => Alerts('Oops! Server error', AlertStatus.RED),
                    0: () => Alerts('Oops! Internet Connection was broken', AlertStatus.RED)
                },
                error: function (xhr, result) {
                    Alerts(result, AlertStatus.RED);
                },
                complete: function () {
                    preloader.remove();
                }
            });
        };
    </script>
}

